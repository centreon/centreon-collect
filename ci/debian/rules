#!/usr/bin/make -f
export DH_VERBOSE=1
export CPU_COUNT=$(nproc --all)

%:
	dh $@  

override_dh_auto_configure:
	mkdir build
	cd build && \
	conan install .. -s compiler.libcxx=libstdc++11 --build=missing && \
	CXXFLAGS="-Wall -Wextra" cmake \
		-DCMAKE_EXPORT_COMPILE_COMMANDS=On \
		-DCMAKE_BUILD_TYPE=RelWithDebInfo \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DWITH_USER_BROKER=centreon-broker \
		-DWITH_USER_ENGINE=centreon-engine \
		-DWITH_GROUP_BROKER=centreon-broker \
		-DWITH_GROUP_ENGINE=centreon-engine \
		-DWITH_TESTING=0 \
		-DWITH_MODULE_SIMU=On \
		-DWITH_BENCH=On \
		-DWITH_CREATE_FILES=OFF \
		..

override_dh_auto_build:
	cd build && \
	make -j9

override_dh_auto_install:
	cd build && \
	make -j9 install DESTDIR=../debian/tmp-centreon-collect
