%define debug_package %{nil}
Name:           centreon-selenium-server
Version:        @VERSION@
Release:        @RELEASE@%{?dist}
Summary:        selenium-server-by-centreon  
Group:          System Environment/Base
License:        GPLv2
URL:            https://github.com/centreon/%{name}-%{version}-%{release}.git
Source0:        %{name}-%{version}.tar.gz
BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
BuildArch:      x86_64
Requires:       firefox, java-1.7.0-openjdk xorg-x11-server-Xvfb perl-XML-Path 

%description
Selenium -www.seleniumhq.org- Selenium automates browsers. Packaged to work with centreon-plugins

%prep
%setup -q
%{_sbindir}/groupadd selenium
%{_sbindir}/useradd -d /home/selenium -s /bin/bash -g selenium selenium 

%build

%install
rm -rf $RPM_BUILD_ROOT
%{__install} -d -m 0755 $RPM_BUILD_ROOT%{_initrddir}
%{__install} -d -m 0755 $RPM_BUILD_ROOT%{_sysconfdir}/default
%{__install} -d -m 0755 $RPM_BUILD_ROOT%{_sysconfdir}/logrotate.d
%{__install} -d -m 0755 $RPM_BUILD_ROOT%{_localstatedir}/run/selenium/
%{__install} -d -m 0755 $RPM_BUILD_ROOT%{_localstatedir}/log/selenium/
%{__install} -d -m 0755 $RPM_BUILD_ROOT/opt/selenium/
%{__install} -d -m 0755 $RPM_BUILD_ROOT/home/selenium/firefox-profile

%{__cp} -r server/selenium-profile/* $RPM_BUILD_ROOT/home/selenium/firefox-profile
%{__cp} server/centos/default-selenium $RPM_BUILD_ROOT%{_sysconfdir}/default/selenium
%{__cp} server/centos/default-xvfb $RPM_BUILD_ROOT%{_sysconfdir}/default/xvfb
%{__cp} server/centos/init-selenium $RPM_BUILD_ROOT%{_initrddir}/selenium
%{__cp} server/centos/init-xvfb $RPM_BUILD_ROOT%{_initrddir}/xvfb
%{__cp} server/centos/logrotate-selenium $RPM_BUILD_ROOT%{_sysconfdir}/logrotate.d/selenium
%{__cp} server/selenium-server-standalone-2.53.0.jar $RPM_BUILD_ROOT/opt/selenium/selenium-server-standalone.jar

%post
if [ $1 -eq 0 ]; then
    /sbin/chkconfig --add xvfb
    /sbin/chkconfig --level 345 xvfb on
    /sbin/chkconfig --add selenium
    /sbin/chkconfig --level 345 selenium on
    service xvfb start > /dev/null 2>&1 || echo
    service selenium start > /dev/null 2>&1 || echo
fi
if [ $1 -eq 1 ]; then
    service selenium restart > /dev/null 2>&1 || echo
fi

%preun
if [ $1 -eq 0 ]; then
    /sbin/service selenium stop &>/dev/null || echo
    /sbin/chkconfig --del selenium
fi

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root,-)
%{_sysconfdir}/default/selenium
%{_sysconfdir}/default/xvfb
%{_initrddir}/selenium
%{_initrddir}/xvfb
%{_sysconfdir}/logrotate.d/selenium
%defattr(-,selenium,selenium,-)
/opt/selenium/selenium-server-standalone.jar
%{_localstatedir}/run/selenium/
%{_localstatedir}/log/selenium
/home/selenium/firefox-profile/.parentlock
/home/selenium/firefox-profile/SiteSecurityServiceState.txt
/home/selenium/firefox-profile/blocklist.xml
/home/selenium/firefox-profile/cert8.db
/home/selenium/firefox-profile/compatibility.ini
/home/selenium/firefox-profile/content-prefs.sqlite
/home/selenium/firefox-profile/cookies.sqlite
/home/selenium/firefox-profile/datareporting/state.json
/home/selenium/firefox-profile/extensions.ini
/home/selenium/firefox-profile/extensions.json
/home/selenium/firefox-profile/gmp-gmpopenh264/1.5.3/gmpopenh264.info
/home/selenium/firefox-profile/gmp-gmpopenh264/1.5.3/libgmpopenh264.so
/home/selenium/firefox-profile/healthreport.sqlite
/home/selenium/firefox-profile/key3.db
/home/selenium/firefox-profile/mimeTypes.rdf
/home/selenium/firefox-profile/permissions.sqlite
/home/selenium/firefox-profile/places.sqlite
/home/selenium/firefox-profile/places.sqlite-shm
/home/selenium/firefox-profile/places.sqlite-wal
/home/selenium/firefox-profile/pluginreg.dat
/home/selenium/firefox-profile/prefs.js
/home/selenium/firefox-profile/revocations.txt
/home/selenium/firefox-profile/search.json
/home/selenium/firefox-profile/secmod.db
/home/selenium/firefox-profile/sessionCheckpoints.json
/home/selenium/firefox-profile/sessionstore-backups/previous.js
/home/selenium/firefox-profile/sessionstore-backups/upgrade.js-20151216205749
/home/selenium/firefox-profile/sessionstore.js
/home/selenium/firefox-profile/times.json
/home/selenium/firefox-profile/webapps/webapps.json
/home/selenium/firefox-profile/webappsstore.sqlite
/home/selenium/firefox-profile/xulstore.json
%doc
