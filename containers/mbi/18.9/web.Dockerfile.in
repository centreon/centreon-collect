# Base information.
FROM ci.int.centreon.com:5000/mon-web-18.9:@DISTRIB@
MAINTAINER Matthieu Kermagoret <mkermagoret@centreon.com>

# Install Centreon MBI repository.
curl -o centreon-mbi-release.rpm "http://srvi-repo.int.centreon.com/yum/mbi/5e0524c1c4773a938c44139ea9d8b4d7/18.9/el7/testing/noarch/RPMS/centreon-mbi-release-18.9-1.el7.centos.noarch.rpm"
yum install --nogpgcheck centreon-mbi-release.rpm
sed -i -e 's#yum.centreon.com#srvi-repo.int.centreon.com/yum#g' -e 's/enabled=0/enabled=1/g' /etc/yum.repos.d/centreon-mbi.repo

# Install Centreon MBI web interface.
RUN yum --disablerepo='*' --enablerepo='centreon*' clean all
RUN yum install --enablerepo='centreon*' centreon-bi-server
COPY web/18.9/install-centreon-module.php /tmp/install-centreon-module.php
RUN chmod +x /tmp/install-centreon-module.php

# Install script.
COPY mbi/18.9/install-web.sh /tmp/install.sh
RUN chmod +x /tmp/install.sh
RUN /tmp/install.sh
