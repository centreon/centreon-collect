# Base information.
FROM ci.int.centreon.com:5000/mon-dependencies:centos@CENTOS_VERSION@
MAINTAINER Matthieu Kermagoret <mkermagoret@centreon.com>

# Copy stable centreon repository

COPY ces-standard-stable.centos@CENTOS_VERSION@.repo /etc/yum.repos.d/ces-standard-stable.repo
COPY plugin-packs.repo /etc/yum.repos.d/plugin-packs.repo


# Install package.

RUN yum --disablerepo='*' --enablerepo='ces-standard-stable*' --enablerepo='plugin-packs*' clean all
RUN yum remove -y centreon*
RUN yum install -y --nogpgcheck centreon-base-config-centreon-engine-2.7.4 centreon-2.7.4 centreon-plugins-2.7.4 centreon-plugin-meta-2.7.4 centreon-common-2.7.4 centreon-web-2.7.4 centreon-trap-2.7.4 centreon-perl-libs-2.7.4
#RUN yum install -y --nogpgcheck centreon-pp-manager-1.4.1


# Install module in Centreon.
COPY install-centreon-module.php /tmp/install-centreon-module.php
COPY ppm/ppm1-install.sh /tmp/ppm1-install.sh
RUN chmod +x /tmp/install-centreon-module.php /tmp/ppm1-install.sh
RUN /tmp/ppm1-install.sh
