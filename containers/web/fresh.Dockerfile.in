# Base information.
FROM ci.int.centreon.com:5000/mon-dependencies:@DISTRIB@
MAINTAINER Matthieu Kermagoret <mkermagoret@centreon.com>

# Install Centreon Web.
RUN yum clean all
RUN yum clean packages
RUN yum install --nogpgcheck -y centreon-base-config-centreon-engine centreon-broker* mysql-server git
COPY web/centengine.sh /etc/init.d/centengine
COPY web/cbd.sh /etc/init.d/cbd

# Prepare environment for autoinstall.
COPY web/autoinstall.php /usr/share/centreon/autoinstall.php

# Install script (web-wizard install).
COPY web/kb.sql /tmp/kb.sql
COPY web/openldap.sql /tmp/openldap.sql
COPY web/fresh.sh /tmp/install.sh
COPY web/kb.sh /tmp/kb.sh
COPY web/openldap.sh /tmp/openldap.sh
RUN chmod +x /tmp/install.sh /tmp/kb.sh /tmp/openldap.sh
RUN /tmp/install.sh
RUN /tmp/kb.sh
RUN /tmp/openldap.sh

# Main script.
COPY web/run.sh /usr/share/centreon/container.sh
RUN chmod +x /usr/share/centreon/container.sh
ENTRYPOINT ["/usr/share/centreon/container.sh"]
