============
Exploitation
============

Generals Principles
-------------------

gorgone-newtest is a module program in charged to get back Newtest services. This program uses the newtest webservice in order to connect and get back the informations of one (or more) Newtest Management Console (NMC).

By default "gorgone-newtest" starts X processes (it depends of the configuration) :

Steps of operation for one process:

- get Centreon datas: robots and scenarios already configured.
- gets from the NMC the list of robots and scenarios: it creates it in centreon with centreon-clapi (It don't disable it or delete it in Centreon).
- gets from the NMC the last status of scenarios: it submits through "centcore" the result.

gorgone-newtest necessitates the utilization of one (or more) NMC.

Configuration
--------------------

The « gorgone-newtest » module is configured with gorgone configuration file ::
 
    modules:
        - name: gorgonenewtest
          module: modules::gorgonenewtest::hooks
          enable: 1
          # in seconds - do purge for container also
          check_containers_time: 3600
          clapi_command: /usr/bin/centreon
          clapi_username: admin
          clapi_password: centreon
          clapi_action_applycfg: RELOAD
          centcore_cmd: /var/lib/centreon/centcore.cmd
          containers:
              - name: toto
                resync_time: 300
                nmc_endpoint: "http://__NMC_ADDRESS__/nws/managementconsoleservice.asmx"
                password: pass
                host_template: generic-active-host-custom
                host_prefix: Robot-%s
                service_template: generic-passive-service-custom
                service_prefix: Scenario-%s
                poller_name: Central
                list_scenario_status: '{ "search": "All", "instances": [] }'
              - name: tutu
                resync_time: 600
                nmc_endpoint: "http://__NMC_ADDRESS__/nws/managementconsoleservice.asmx"
                password: pass
                host_template: generic-active-host-custom
                host_prefix: Robot-%s
                service_template: generic-passive-service-custom
                service_prefix: Scenario-%s
                poller_name: Central
                list_scenario_status: '{ "search": "Robot", "instances": ["XXXX"] }' 

You have to add at least one entry in the configuration. The meaning of attributes :

- 'nmc_endpoint': address of the NMC
- 'nmc_timeout': timeout NMC console response
- 'host_template': template used when the daemon creates a host in Centreon
- 'host_prefix': name used when the daemon creates and looks for a host in Centreon
- 'service_templte': template used when the daemon creates a service in Centreon
- 'service_prefix': name used when the daemon creates and looks for a service in Centreon
- 'poller_name': poller used when the daemon creates a host in Centreon
- 'clapi_username' and 'clapi_password': centreon-clapi connections 
- 'clapi_action_applycfg': could be 'POLLERRELOAD' or 'POLLERRESTART'
- 'list_scenario_status': informations to gets from NMC :
   - To get all robots: { "search": "All", "instances": [] } 
   - To filter on some robots: { "search": "Robot", "instances": ["XXXX", "YYYY"] }

Troubleshooting
---------------

It is possible to get this kind of errors in the « logs » of « gorgone-newtest » ::

    die: syntax error at line 1, column 0, byte 0 at /usr/lib/perl5/vendor_perl/5.8.8/i386-linux-thread-multi/XML/Parser.pm line 189

It often means that there is a timeout error.
