# Base image is from the docker-rpm-builder project.
FROM alanfranz/drb-epel-@CENTOS_VERSION@-x86-64
MAINTAINER Matthieu Kermagoret <mkermagoret@centreon.com>

# Install development repository.
COPY repo/centreon-standard-stable.centos@CENTOS_VERSION@.repo /etc/yum.repos.d/centreon-standard-stable.repo
COPY repo/centreon-internal.centos@CENTOS_VERSION@.repo /etc/yum.repos.d/centreon-internal.repo

# Install required build dependencies for all Centreon projects.
RUN mkdir /usr/share/monitoring
COPY build-dependencies.centos@CENTOS_VERSION@.txt /usr/share/monitoring/build-dependencies.txt
RUN yum install --downloadonly `cat /usr/share/monitoring/build-dependencies.txt`

# Install Node.js and related elements.
RUN curl --silent --location https://rpm.nodesource.com/setup_4.x | bash -
RUN yum install --nogpgcheck -y nodejs
RUN npm install -g gulp

# Install Composer.
RUN yum install -y php php-cli
RUN curl -sS https://getcomposer.org/installer | php
RUN mv composer.phar /usr/local/bin/composer
RUN chmod +x /usr/local/bin/composer

# Workaround, yum does not seem to exit correctly.
RUN rm -f /var/run/yum.pid
