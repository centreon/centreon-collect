# Base information.
FROM ci.int.centreon.com:5000/mon-dependencies:centos@CENTOS_VERSION@
MAINTAINER Matthieu Kermagoret <mkermagoret@centreon.com>

# Install all build dependencies of Centreon components.
COPY build-dependencies.centos@CENTOS_VERSION@.txt /usr/share/monitoring/build-dependencies.txt
RUN yum install --nogpgcheck -y `cat /usr/share/monitoring/build-dependencies.txt`

# Install PHPUnit (the 4.8 release being the latest to support PHP 5.3).
RUN wget -O /usr/local/bin/phpunit https://phar.phpunit.de/phpunit-4.8.23.phar
RUN chmod +x /usr/local/bin/phpunit
# Install Xdebug PHP extension (for PHPUnit code coverage).
RUN wget https://dl.fedoraproject.org/pub/epel/epel-release-latest-@CENTOS_VERSION@.noarch.rpm
RUN yum install --nogpgcheck -y epel-release-latest-@CENTOS_VERSION@.noarch.rpm
RUN yum install -y php-pecl-xdebug

# Install unit tests scripts.
COPY unittest/unittest-broker.sh /usr/local/bin/unittest-broker
COPY unittest/unittest-engine.sh /usr/local/bin/unittest-engine
COPY unittest/unittest-ppe.sh /usr/local/bin/unittest-ppe
COPY unittest/unittest-lm.sh /usr/local/bin/unittest-lm
COPY unittest/unittest-middleware.sh /usr/local/bin/unittest-middleware
COPY unittest/unittest-ppm.sh /usr/local/bin/unittest-ppm
COPY unittest/unittest-web.sh /usr/local/bin/unittest-web
COPY unittest/unittest-bam.sh /usr/local/bin/unittest-bam
RUN chmod +x /usr/local/bin/*
