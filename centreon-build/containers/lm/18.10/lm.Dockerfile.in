# Base information.
FROM ci.int.centreon.com:5000/mon-web-18.10:@DISTRIB@
LABEL maintainer="Matthieu Kermagoret <mkermagoret@centreon.com>"

# Set middleware server
ENV CENTREON_IMP_SERVER HELLOWORLD:http://middleware:3000/api
RUN echo 'env[CENTREON_IMP_SERVER] = HELLOWORLD:http://middleware:3000/api' >> /etc/opt/rh/rh-php71/php-fpm.d/www.conf

# Install package.
RUN yum --disablerepo='*' --enablerepo='centreon-internal*' clean all && \
    yum install -y centreon-license-manager && \
    yum clean all

# Install module in Centreon.
COPY web/18.10/install-centreon-module.php lm/18.10/install.sh /tmp/
RUN chmod +x /tmp/install-centreon-module.php /tmp/install.sh && \
    /tmp/install.sh
