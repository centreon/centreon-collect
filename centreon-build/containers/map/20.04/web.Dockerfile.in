# Base information.
FROM @BASE_IMAGE@
MAINTAINER Matthieu Kermagoret <mkermagoret@centreon.com>

# Install repository.
COPY repo/centreon-internal.repo /etc/yum.repos.d/centreon-internal.repo

# Install Centreon Map web client and Centreon BAM.
RUN curl -o centreon-bam-release.rpm http://srvi-repo.int.centreon.com/yum/bam/d4e1d7d3e888f596674453d1f20ff6d3/20.04/el7/stable/noarch/RPMS/centreon-bam-release-20.04-1.el7.centos.noarch.rpm && \
    yum install centreon-bam-release.rpm && \
    yum-config-manager --enable 'centreon-bam-testing*' && \
    yum-config-manager --enable 'centreon-bam-unstable*' && \
    yum install -y centreon-bam-server centreon-map4-web-client && \
    rm -f /etc/yum.repos.d/centreon-internal.repo && \
    yum clean all
COPY web/20.04/install-centreon-module.php /tmp/install-centreon-module.php
RUN chmod +x /tmp/install-centreon-module.php

# Install license file.
COPY bam/bam.license /etc/centreon/license.d/bam.license
COPY map/licence.json.asc /etc/centreon/license.d/map.license

# Install script.
COPY map/20.04/install-web.sh /tmp/install.sh
RUN chmod +x /tmp/install.sh
RUN /tmp/install.sh
