FROM ci.int.centreon.com:5000/mon-web-stable:@DISTRIB@
MAINTAINER Matthieu Kermagoret <mkermagoret@centreon.com>

# Update to the latest Engine and Broker.
COPY centreon/@DISTRIB@/*.rpm /tmp/
RUN yum -y --nogpgcheck '--disablerepo=*' install /tmp/*.rpm
COPY web/centengine.sh /etc/init.d/centengine
COPY web/cbd.sh /etc/init.d/cbd

# Centreon update is made through custom scripts.
COPY web/update-centreon.php /tmp/update-centreon.php
COPY web/dev.sh /tmp/install.sh
RUN chmod +x /tmp/install.sh
COPY centreon/www/install /usr/share/centreon/www/install
RUN /tmp/install.sh

# Static sources.
COPY centreon/www/sounds /usr/share/centreon/www/sounds
COPY centreon/www/img /usr/share/centreon/www/img
COPY centreon/www/include /usr/share/centreon/www/include
COPY centreon/www/modules /usr/share/centreon/www/modules
COPY centreon/www/index.php /usr/share/centreon/www/index.php
COPY centreon/www/main.php /usr/share/centreon/www/main.php
COPY centreon/www/Themes /usr/share/centreon/www/Themes
COPY centreon/www/widgets /usr/share/centreon/www/widgets
COPY centreon/www/api /usr/share/centreon/www/api
COPY centreon/www/class /usr/share/centreon/www/class
COPY centreon/www/lib /usr/share/centreon/www/lib
