# Base.
FROM centos:@CENTOS_VERSION@
LABEL maintainer="Matthieu Kermagoret <mkermagoret@centreon.com>"
COPY dependencies.centos@CENTOS_VERSION@.txt /tmp/dependencies.txt
RUN echo 'http_caching=none' >> /etc/yum.conf && \
    yum install -y bzip2 curl git nc wget php-process && \
    wget http://yum.centreon.com/standard/3.4/el@CENTOS_VERSION@/stable/noarch/RPMS/centreon-release-3.4-4.el@CENTOS_VERSION@.noarch.rpm || \
        wget http://yum.centreon.com/standard/3.4/el@CENTOS_VERSION@/stable/noarch/RPMS/centreon-release-3.4-4.el@CENTOS_VERSION@.centos.noarch.rpm && \
    curl --silent --location https://rpm.nodesource.com/setup_4.x | bash - && \
    yum install -y centreon-release-*.rpm && \
    yum install -y `cat /tmp/dependencies.txt` \
        nodejs && \
    echo 'date.timezone = Europe/Paris' > /etc/php.d/centreon.ini && \
    npm install -g gulp && \
    curl -sS https://getcomposer.org/installer | php && \
    mv composer.phar /usr/local/bin/composer && \
    chmod +x /usr/local/bin/composer && \
    yum clean all