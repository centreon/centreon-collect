###############################
# Makefile for NDO
#
# Last Modified: 28-04-2009
###############################


# Source code directories
SRC_INCLUDE=../include

CC=@CC@
CP=@CP@

CFLAGS=@CFLAGS@ @DEFS@ 

# We don't like ANSI because ANSI doesn't like us! phhht!
#CFLAGS=-g -Wall -ansi -pedantic -DHAVE_CONFIG_H

# Compiler flags for use with Valgrind
#CFLAGS=-O0 -g -DHAVE_CONFIG_H

MOD_CFLAGS=@MOD_CFLAGS@
LDFLAGS=@LDFLAGS@
MOD_LDFLAGS=@MOD_LDFLAGS@
LIBS=@LIBS@
SOCKETLIBS=@SOCKETLIBS@
DBCFLAGS=@DBCFLAGS@
DBLDFLAGS=@DBLDFLAGS@
DBLIBS=@DBLIBS@
MATHLIBS=-lm
OTHERLIBS=@OTHERLIBS@

COMMON_INC=$(SRC_INCLUDE)/config.h $(SRC_INCLUDE)/common.h $(SRC_INCLUDE)/io.h $(SRC_INCLUDE)/protoapi.h $(SRC_INCLUDE)/utils.h
COMMON_SRC=io.c utils.c
COMMON_OBJS=io.o utils.o

NDO_INC=$(SRC_INCLUDE)/ndo2db.h $(SRC_INCLUDE)/db.h
NDO_SRC=db.c dbhandlers.c ndo2db.c stmt.c
NDO_OBJS=$(NDO_SRC:.c=.o)


all: ndo2db ndomod.o sockdebug

ndo2db: $(NDO_INC) $(NDO_OBJS) $(COMMON_INC) $(COMMON_OBJS)
	$(CC) -o ndo2db $(COMMON_OBJS) $(NDO_OBJS) $(LDFLAGS) $(DBLDFLAGS) $(LIBS) $(SOCKETLIBS) $(DBLIBS) $(MATHLIBS) $(OTHERLIBS)

ndomod.o: ndomod.c $(COMMON_INC) $(COMMON_OBJS)
	$(CC) $(MOD_CFLAGS) $(CFLAGS) -o ndomod.o ndomod.c $(COMMON_OBJS) $(MOD_LDFLAGS) $(LDFLAGS) $(LIBS) $(SOCKETLIBS) $(OTHERLIBS)

sockdebug: sockdebug.c $(COMMON_INC) $(COMMON_OBJS)
	$(CC) $(CFLAGS) -o $@ sockdebug.c $(COMMON_OBJS) $(LDFLAGS) $(LIBS) $(MATHLIBS) $(SOCKETLIBS) $(OTHERLIBS)

ndo2db.o: ndo2db.c $(SRC_INCLUDE)/ndo2db.h
	$(CC) $(CFLAGS) $(DBCFLAGS) -c -o $@ ndo2db.c

io.o: io.c $(SRC_INCLUDE)/io.h
	$(CC) $(MOD_CFLAGS) $(CFLAGS) -c -o $@ io.c

utils.o: utils.c $(SRC_INCLUDE)/utils.h
	$(CC) $(MOD_CFLAGS) $(CFLAGS) -c -o $@ utils.c

db.o: db.c $(SRC_INCLUDE)/db.h
	$(CC) $(CFLAGS) -c -o $@ db.c

dbhandlers.o: dbhandlers.c $(SRC_INCLUDE)/dbhandlers.h
	$(CC) $(CFLAGS) -D_BSD_SOURCE -c -o $@ dbhandlers.c

stmt.o: stmt.c $(SRC_INCLUDE)/stmt.h
	$(CC) $(CFLAGS) -c -o $@ stmt.c

clean:
	rm -f core file2sock log2ndo ndo2db sockdebug *.o
	rm -f *~ */*~

distclean: clean
	rm -f Makefile

devclean: distclean
