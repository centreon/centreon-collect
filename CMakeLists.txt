cmake_minimum_required(VERSION 3.4)
project("Centreon Collect" C CXX)
set(CMAKE_CXX_STANDARD 17)

include(GNUInstallDirs)

# Version.
set(COLLECT_MAJOR 20)
set(COLLECT_MINOR 10)
set(COLLECT_PATCH 0)
set(COLLECT_VERSION "${COLLECT_MAJOR}.${COLLECT_MINOR}.${COLLECT_PATCH}")
add_definitions(-DCENTREON_CONNECTOR_VERSION=\"${COLLECT_VERSION}\")
add_definitions(-DCENTREON_BROKER_VERSION=\"${COLLECT_VERSION}\")

if(EXISTS ${CMAKE_BINARY_DIR}/conanbuildinfo.cmake)
  include(${CMAKE_BINARY_DIR}/conanbuildinfo.cmake)
  conan_basic_setup(TARGETS)
else()
  message(WARNING "The file conanbuildinfo.cmake doesn't exist, you have to run conan install first")
endif()

############ CONSTANTS ###########
set(USER_BROKER centreon-broker)
set(USER_ENGINE centreon-engine)
##################################

add_subdirectory(src/10-neb)
add_subdirectory(src/15-stats)
add_subdirectory(src/20-bam)
add_subdirectory(src/20-storage)
add_subdirectory(src/50-tcp)
add_subdirectory(src/60-tls)
add_subdirectory(src/70-graphite)
add_subdirectory(src/70-influxdb)
add_subdirectory(src/70-lua)
add_subdirectory(src/70-simu)
add_subdirectory(src/70-rrd)
add_subdirectory(src/80-sql)
add_subdirectory(src/cbd)
add_subdirectory(src/cbmod)
add_subdirectory(src/cbwd)
add_subdirectory(src/ccb_conflict_manager)
add_subdirectory(src/ccb_core)
add_subdirectory(src/ccb_neb)
add_subdirectory(src/ccb_rpc)
add_subdirectory(src/ccb_sql)
add_subdirectory(src/cce_core)
add_subdirectory(src/external_command)
add_subdirectory(src/cce_rpc)
add_subdirectory(src/centengine)
add_subdirectory(src/centenginestats)
add_subdirectory(src/centenginestats2)
add_subdirectory(src/clib)
add_subdirectory(src/connectors)

#if (WITH_TESTING)
  add_subdirectory(tests/broker)
  add_subdirectory(tests/cbwd)
  add_subdirectory(tests/clib)
  add_subdirectory(tests/connectors)
  add_subdirectory(tests/engine)
#endif()

install(FILES ${CMAKE_SOURCE_DIR}/script/centreon-broker.logrotate COMPONENT core RENAME cbd DESTINATION "${CMAKE_INSTALL_SYSCONFDIR}/logrotate.d")
install(DIRECTORY COMPONENT broker DESTINATION ${CMAKE_INSTALL_CONFDIR}/centreon-broker)
install(DIRECTORY COMPONENT broker DESTINATION ${CMAKE_INSTALL_LOCALSTATEDIR}/log/centreon-broker)
install(DIRECTORY COMPONENT broker DESTINATION ${CMAKE_INSTALL_LOCALSTATEDIR}/lib/centreon-broker)

install(DIRECTORY COMPONENT core DESTINATION ${CMAKE_INSTALL_DATADIR}/centreon-broker/lua)
install(FILES ${CMAKE_SOURCE_DIR}/LICENSE COMPONENT clib DESTINATION  ${CMAKE_INSTALL_DATAROOTDIR}/doc/centreon-clib-${COLLECT_VERSION})

include(CMakeCPack.cmake)

